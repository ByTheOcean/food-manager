<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿå“æœ‰æ•ˆæœŸç®¡ç†</title>
    <meta name="description" content="é€šè¿‡NFCç®¡ç†é£Ÿå“æœ‰æ•ˆæœŸçš„æ™ºèƒ½æé†’åº”ç”¨">
    <meta name="theme-color" content="#4CAF50">
    
    <!-- PWAé…ç½® -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <style>
        /* åŸºç¡€æ ·å¼ - å®Œæ•´æ ·å¼è¯·ä½¿ç”¨åé¢æä¾›çš„å®Œæ•´ä»£ç  */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥« é£Ÿå“æœ‰æ•ˆæœŸç®¡ç†</h1>
        
        <div class="card">
            <button id="scanNFC">ğŸ“± æ‰«æNFCæ ‡ç­¾</button>
            <div id="nfcStatus"></div>
        </div>
        
        <div class="card">
            <h2>æ·»åŠ é£Ÿå“ä¿¡æ¯</h2>
            <form id="foodForm">
                <input type="text" id="foodName" placeholder="é£Ÿå“åç§°" required>
                <input type="date" id="expiryDate" required>
                <select id="category">
                    <option value="å†·è—">å†·è—</option>
                    <option value="å†·å†»">å†·å†»</option>
                    <option value="å¸¸æ¸©">å¸¸æ¸©</option>
                </select>
                <button type="submit">æ·»åŠ é£Ÿå“</button>
            </form>
        </div>
        
        <div class="card">
            <h2>æˆ‘çš„é£Ÿå“æ¸…å•</h2>
            <div id="foodList"></div>
        </div>
    </div>

    <script>
        class FoodManager {
            constructor() {
                this.foods = JSON.parse(localStorage.getItem('foods')) || [];
                this.init();
            }
            
            init() {
                document.getElementById('foodForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addFood();
                });
                
                // åˆå§‹åŒ–NFCåŠŸèƒ½
                this.initNFC();
                this.renderList();
                this.startReminderCheck();
            }
            
            // NFCåŠŸèƒ½åˆå§‹åŒ–
            initNFC() {
                const scanBtn = document.getElementById('scanNFC');
                const statusEl = document.getElementById('nfcStatus');
                
                // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒWeb NFC
                if ('nfc' in navigator) {
                    statusEl.innerHTML = 'âœ… NFCåŠŸèƒ½å¯ç”¨';
                    scanBtn.addEventListener('click', () => {
                        this.scanNFCTag();
                    });
                } else {
                    statusEl.innerHTML = 'âŒ æµè§ˆå™¨ä¸æ”¯æŒNFCåŠŸèƒ½<br>' +
                        '<small>è¯·ä½¿ç”¨Android Chromeæµè§ˆå™¨</small>';
                    scanBtn.disabled = true;
                    scanBtn.innerHTML = 'ğŸ“± NFCä¸å¯ç”¨';
                }
            }
            
            // æ‰«æNFCæ ‡ç­¾
            async scanNFCTag() {
                const statusEl = document.getElementById('nfcStatus');
                
                try {
                    statusEl.innerHTML = 'ğŸ” è¯·å°†æ‰‹æœºé è¿‘NFCæ ‡ç­¾...';
                    
                    // æ¨¡æ‹ŸNFCæ‰«æï¼ˆå®é™…ç¯å¢ƒä¸­éœ€è¦çœŸå®NFCæ”¯æŒï¼‰
                    this.simulateNFCScan();
                    
                } catch (error) {
                    console.error('NFCæ‰«æé”™è¯¯:', error);
                    statusEl.innerHTML = 'âŒ NFCæ‰«æå¤±è´¥: ' + error.message;
                }
            }
            
            // æ¨¡æ‹ŸNFCæ‰«æï¼ˆç”¨äºæµ‹è¯•ï¼‰
            simulateNFCScan() {
                const statusEl = document.getElementById('nfcStatus');
                
                // æ˜¾ç¤ºæ¨¡æ‹Ÿçš„NFCæ•°æ®
                statusEl.innerHTML = 'âœ… æ‰«æåˆ°NFCæ ‡ç­¾ï¼æ­£åœ¨å¡«å……æ•°æ®...';
                
                // æ¨¡æ‹Ÿå»¶è¿Ÿï¼Œç„¶åå¡«å……è¡¨å•
                setTimeout(() => {
                    // éšæœºé€‰æ‹©ä¸€äº›æµ‹è¯•æ•°æ®
                    const testFoods = [
                        { name: 'ç‰›å¥¶', expiry: '2025-10-15', category: 'å†·è—' },
                        { name: 'é¸¡è›‹', expiry: '2025-10-20', category: 'å†·è—' },
                        { name: 'é¢åŒ…', expiry: '2025-10-08', category: 'å¸¸æ¸©' },
                        { name: 'é¸¡è‚‰', expiry: '2025-10-06', category: 'å†·å†»' }
                    ];
                    
                    const randomFood = testFoods[Math.floor(Math.random() * testFoods.length)];
                    
                    // å¡«å……è¡¨å•
                    document.getElementById('foodName').value = randomFood.name;
                    document.getElementById('expiryDate').value = randomFood.expiry;
                    document.getElementById('category').value = randomFood.category;
                    
                    statusEl.innerHTML = `âœ… å·²å¡«å……: ${randomFood.name} (${randomFood.expiry})`;
                    
                }, 1500);
            }
            
            addFood() {
                const foodData = {
                    id: Date.now(),
                    name: document.getElementById('foodName').value,
                    expiryDate: document.getElementById('expiryDate').value,
                    category: document.getElementById('category').value,
                    addedDate: new Date().toISOString(),
                    nfcScanned: true
                };
                
                this.foods.push(foodData);
                this.save();
                this.renderList();
                
                // è®¾ç½®æé†’
                this.scheduleReminder(foodData);
                
                document.getElementById('foodForm').reset();
                this.showToast(`âœ… å·²æ·»åŠ  ${foodData.name}`);
                
                // æ¸…ç©ºNFCçŠ¶æ€
                document.getElementById('nfcStatus').innerHTML = '';
            }
            
            scheduleReminder(food) {
                // è¿™é‡Œå¯ä»¥æ·»åŠ æé†’é€»è¾‘
                console.log(`å·²ä¸º ${food.name} è®¾ç½®æé†’`);
            }
            
            showToast(message) {
                // ç®€å•çš„æç¤ºæ˜¾ç¤º
                alert(message);
            }
            
            renderList() {
                const listEl = document.getElementById('foodList');
                if (this.foods.length === 0) {
                    listEl.innerHTML = '<p>æš‚æ— é£Ÿå“è®°å½•</p>';
                    return;
                }
                
                listEl.innerHTML = this.foods.map(food => `
                    <div style="border:1px solid #ccc; padding:10px; margin:5px 0; border-radius:5px;">
                        <h3>${food.name} ${food.nfcScanned ? 'ğŸ“±' : ''}</h3>
                        <p>è¿‡æœŸ: ${food.expiryDate} | åˆ†ç±»: ${food.category}</p>
                        <button onclick="foodManager.removeFood(${food.id})">åˆ é™¤</button>
                    </div>
                `).join('');
            }
            
            removeFood(id) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé£Ÿå“è®°å½•å—ï¼Ÿ')) {
                    this.foods = this.foods.filter(food => food.id !== id);
                    this.save();
                    this.renderList();
                }
            }
            
            save() {
                localStorage.setItem('foods', JSON.stringify(this.foods));
            }
            
            startReminderCheck() {
                // è¿™é‡Œå¯ä»¥æ·»åŠ å®šæœŸæ£€æŸ¥æé†’çš„é€»è¾‘
            }
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            window.foodManager = new FoodManager();
        });
    </script>
</body>
</html>